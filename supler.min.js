var FieldTypes=function(){function a(){}return a.STRING="string",a.INTEGER="integer",a.FLOAT="float",a.BOOLEAN="boolean",a.SELECT="select",a.SUBFORM="subform",a.STATIC="static",a.ACTION="action",a.META="meta",a}(),SuplerAttributes=function(){function a(){}return a.FIELD_TYPE="supler:fieldType",a.MULTIPLE="supler:multiple",a.FIELD_NAME="supler:fieldName",a.VALIDATION_ID="supler:validationId",a.PATH="supler:path",a}(),FormSections=function(){function a(){}return a.META="supler_meta",a}(),CreateFormFromJson=function(){function a(a,b,c){this.renderOptionsGetter=a,this.i18n=b,this.validatorFnFactories=c,this.idCounter=0}return a.prototype.renderForm=function(a,b,c){void 0===c&&(c=new FormElementDictionary);for(var d=b.fields,e=d.length,f=this.generateMeta(a),g=0;e>g;g++){var h=d[g],i=this.fieldFromJson(h,c,!1);i&&(f+=i+"\n")}return new RenderFormResult(f,c)},a.prototype.generateMeta=function(a){if(a){var b='<span class="supler_meta" style="display: none; visibility: hidden">\n';return Util.foreach(a,function(a,c){var d={type:"hidden",value:c};d[SuplerAttributes.FIELD_TYPE]=FieldTypes.META,d[SuplerAttributes.FIELD_NAME]=a,b+=HtmlUtil.renderTag("input",d)+"\n"}),b+"</span>\n"}return""},a.prototype.fieldFromJson=function(a,b,c){var d=this.nextId(),e=this.nextId(),f=new FieldData(d,e,a,this.labelFor(a.label)),g=this.fieldHtmlFromJson(f,b,c);return g?(b.getElement(d).validator=new ElementValidator(this.fieldValidatorFns(f),f.validate.required,a.empty_value),g):null},a.prototype.fieldValidatorFns=function(a){var b=this,c=[],d=this.validatorFnFactories["type_"+a.type];d&&c.push(d.apply(this));var e=a.validate;return Util.foreach(e,function(d,e){b.validatorFnFactories[d]&&c.push(b.validatorFnFactories[d](e,a.json))}),c},a.prototype.fieldHtmlFromJson=function(a,b,c){var d=this.renderOptionsGetter.forField(a.path,a.type,a.getRenderHintName()),e=Util.copyProperties({id:a.id,name:a.path,"supler:fieldName":a.name,"supler:fieldType":a.type,"supler:multiple":a.multiple,"supler:validationId":a.validationId,"supler:path":a.path},d.additionalFieldOptions());switch(a.enabled||(e.disabled=!0),a.type){case FieldTypes.STRING:return this.stringFieldFromJson(d,a,e,c);case FieldTypes.INTEGER:return d.renderIntegerField(a,e,c);case FieldTypes.FLOAT:return d.renderFloatField(a,e,c);case FieldTypes.BOOLEAN:return this.booleanFieldFromJson(d,a,e,c);case FieldTypes.SELECT:return this.selectFieldFromJson(d,a,e,c);case FieldTypes.SUBFORM:return this.subformFieldFromJson(d,a,b);case FieldTypes.STATIC:return this.staticFieldFromJson(d,a,c);case FieldTypes.ACTION:return this.actionFieldFromJson(d,a,e,b,c);default:return null}},a.prototype.stringFieldFromJson=function(a,b,c,d){if("password"===b.getRenderHintName())return a.renderPasswordField(b,c,d);if("textarea"===b.getRenderHintName()){var e=Util.copyProperties({rows:b.json.render_hint.rows,cols:b.json.render_hint.cols},c);return a.renderTextareaField(b,e,d)}return"hidden"===b.getRenderHintName()?a.renderHiddenField(b,c,d):a.renderStringField(b,c,d)},a.prototype.booleanFieldFromJson=function(a,b,c,d){var e=[new SelectValue("0",this.i18n.label_boolean_false()),new SelectValue("1",this.i18n.label_boolean_true())];return b.value=b.value?"1":"0",a.renderSingleChoiceRadioField(b,e,this.checkableContainerOptions(b.id,c),c,d)},a.prototype.selectFieldFromJson=function(a,b,c,d){var e=this,f=b.json.possible_values.map(function(a){return new SelectValue(a.id,e.labelFor(a.label))}),g=this.checkableContainerOptions(b.id,c);if(b.multiple)return a.renderMultiChoiceCheckboxField(b,f,g,c,d);var h=b.json.validate&&b.json.validate.required,i=b.value===b.json.empty_value,j="radio"===b.getRenderHintName();return j||h&&!i||(f=[new SelectValue(null,"")].concat(f)),j?a.renderSingleChoiceRadioField(b,f,g,c,d):a.renderSingleChoiceSelectField(b,f,g,c,d)},a.prototype.checkableContainerOptions=function(a,b){return{id:a,"supler:validationId":b[SuplerAttributes.VALIDATION_ID],"supler:path":b[SuplerAttributes.PATH]}},a.prototype.subformFieldFromJson=function(a,b,c){var d,e=this,f="",g={"supler:fieldType":FieldTypes.SUBFORM,"supler:fieldName":b.name,"supler:multiple":b.multiple};if(d="undefined"!=typeof b.value?b.multiple?b.value:[b.value]:[],this.propagateDisabled(b,d),"list"===b.getRenderHintName())for(var h in d){var i=this.renderForm(null,d[h],c);f+=a.renderSubformListElement(i.html,g)}else{for(var j=this.getTableHeaderLabels(b.json),k=[],l=0;l<d.length;l++){var m=0;k[l]=[];var n=d[l].fields;Util.foreach(n,function(a,b){k[l][m]=e.fieldFromJson(b,c,!0),m+=1})}f+=a.renderSubformTable(j,k,g)}return a.renderSubformDecoration(f,b.label,b.id,b.name)},a.prototype.propagateDisabled=function(a,b){if(!a.enabled)for(var c in b)Util.foreach(b[c].fields,function(a,b){return b.enabled=!1})},a.prototype.staticFieldFromJson=function(a,b,c){var d=this.i18n.fromKeyAndParams(b.value.key,b.value.params);return d||(d="-"),b.value=d,a.renderStaticField(b,c)},a.prototype.actionFieldFromJson=function(a,b,c,d,e){return d.getElement(b.id).validationScope=ValidationScopeParser.fromJson(b.json.validation_scope),a.renderActionField(b,c,e)},a.prototype.getTableHeaderLabels=function(a){var b=this;if(a.value.length>0){var c=a.value[0],d=[];return Util.foreach(c.fields,function(a,c){d.push(c.type===FieldTypes.ACTION?"":b.labelFor(c.label))}),d}return[]},a.prototype.labelFor=function(a){return this.i18n.fromKeyAndParams(a,[])},a.prototype.nextId=function(){return this.idCounter+=1,"id"+this.idCounter},a}(),RenderFormResult=function(){function a(a,b){this.html=a,this.formElementDictionary=b}return a}(),ElementSearch=function(){function a(a){this.container=a,this.idxPattern=/([^\[]+)\[(\d+)\]/}return a.prototype.byPath=function(a){return this.insideByPath(this.container,a.split("."))},a.prototype.insideByPath=function(a,b){if(0===b.length)return a;var c=b.shift(),d=this.searchForElement(a,c);return d?this.insideByPath(d,b):null},a.prototype.searchForElement=function(a,b){for(var c=this.extractElementIdx(b),d=c.pathPart,e=c.elementIdx,f=[a];f.length>0;){var g=f.shift();if(g.getAttribute(SuplerAttributes.FIELD_NAME)===d){if(0===e)return g;e-=1}else for(var h=g.children,i=0;i<h.length;i++)f.push(h[i])}return null},a.prototype.extractElementIdx=function(a){var b=this.idxPattern.exec(a);return b&&b.length>=3?{pathPart:b[1],elementIdx:parseInt(b[2])}:{pathPart:a,elementIdx:0}},a}(),FieldData=function(){function a(a,b,c,d){this.id=a,this.validationId=b,this.json=c,this.label=d,this.name=c.name,this.value=c.value,this.path=c.path,this.multiple=c.multiple,this.type=c.type,this.enabled=c.enabled,this.validate=c.validate||{}}return a.prototype.getRenderHintName=function(){return this.json.render_hint?this.json.render_hint.name:null},a}(),FormElement=function(){function a(){}return a}(),FormElementDictionary=function(){function a(){this.formElements=[]}return a.prototype.getElement=function(a){var b=this.formElements[a];return b||(b=new FormElement,this.formElements[a]=b),b},a.prototype.foreach=function(a){Util.foreach(this.formElements,a)},a}(),HtmlUtil=function(){function a(){}return a.renderTag=function(b,c,d,e){void 0===d&&(d=null),void 0===e&&(e=!0);var f="<"+b+" ";return f+=a.renderAttrs(c),f+=">",d&&(f+=e?a.escapeForAttribute(d,!0):d),f+="</"+b+">"},a.renderAttrs=function(b){var c="";return Util.foreach(b,function(b,d){(d||0===d||""===d||d===!1)&&(c+=b+'="'+a.escapeForAttribute(d,!1)+'" ')}),c},a.addClass=function(a,b){-1===a.className.indexOf(b)&&(a.className=a.className+" "+b)},a.removeClass=function(a,b){a.className=a.className.replace(b,"")},a.escapeForAttribute=function(a,b){return b=b?"&#13;":"\n",(""+a).replace(/&/g,"&amp;").replace(/'/g,"&apos;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r\n/g,b).replace(/[\r\n]/g,b)},a.findElementWithAttr=function(b,c){if(b.hasAttribute(c))return b;for(var d=b.children.length,e=0;d>e;e++){var f=b.children[e];if(f.tagName){var g=a.findElementWithAttr(f,c);if(g)return g}}throw"No element with attribute "+c+" found!"},a}(),I18n=function(){function a(){}return a.prototype.fromKeyAndParams=function(a,b){var c=this[a];return c&&"function"==typeof c?c.apply(this,b):c?c:a},a.prototype.error_valueRequired=function(){return"Value is required"},a.prototype.error_number_ge=function(a){return"Must be greater or equal to "+a},a.prototype.error_number_gt=function(a){return"Must be greater than "+a},a.prototype.error_number_le=function(a){return"Must be less or equal to "+a},a.prototype.error_number_lt=function(a){return"Must be less than "+a},a.prototype.error_length_tooShort=function(a){return"Too short; minimum length: "+a},a.prototype.error_length_tooLong=function(a){return"Too long; maximum length: "+a},a.prototype.error_type_number=function(){return"Must be a number"},a.prototype.label_boolean_true=function(){return"Yes"},a.prototype.label_boolean_false=function(){return"No"},a}(),ReadFormValues=function(){function a(){}return a.getValueFrom=function(b,c,d){void 0===c&&(c=null),void 0===d&&(d={});var e=b.getAttribute(SuplerAttributes.FIELD_TYPE),f="true"===b.getAttribute(SuplerAttributes.MULTIPLE);if(b.disabled)return d;if(e){var g=b.getAttribute(SuplerAttributes.FIELD_NAME);switch(e){case FieldTypes.STRING:a.appendFieldValue(d,g,this.getElementValue(b),f);break;case FieldTypes.INTEGER:a.appendFieldValue(d,g,this.parseIntOrNull(this.getElementValue(b)),f);break;case FieldTypes.FLOAT:a.appendFieldValue(d,g,this.parseFloatOrNull(this.getElementValue(b)),f);break;case FieldTypes.SELECT:a.appendFieldValue(d,g,this.getElementValue(b),f);break;case FieldTypes.BOOLEAN:a.appendFieldValue(d,g,this.parseBooleanOrNull(this.getElementValue(b)),f);break;case FieldTypes.ACTION:b.id===c&&a.appendFieldValue(d,g,!0,!1);break;case FieldTypes.SUBFORM:g=b.getAttribute(SuplerAttributes.FIELD_NAME);var h=this.getValueFromChildren(b,c,{});a.appendFieldValue(d,g,h,f);break;case FieldTypes.META:a.appendMetaValue(d,g,this.getElementValue(b))}}else b.children.length>0&&this.getValueFromChildren(b,c,d);return d},a.getValueFromChildren=function(a,b,c){for(var d=a.children,e=0;e<d.length;e++)this.getValueFrom(d[e],b,c);return c},a.getElementValue=function(a){if("radio"!==a.type&&"checkbox"!==a.type||a.checked){if("SELECT"===a.nodeName){var b=a.options[a.selectedIndex];return b.hasAttribute("value")?b.value:null}return a.value}return null},a.appendFieldValue=function(a,b,c,d){d?(a[b]=a[b]||[],null!==c&&a[b].push(c)):(null===a[b]||"undefined"==typeof a[b])&&(a[b]=c)},a.appendMetaValue=function(a,b,c){var d;(d=a[FormSections.META])||(a[FormSections.META]=d={}),d[b]=c},a.parseIntOrNull=function(a){var b=parseInt(a);return isNaN(b)?null:b},a.parseFloatOrNull=function(a){var b=parseFloat(a);return isNaN(b)?null:b},a.parseBooleanOrNull=function(a){return null===a?null:"1"===a},a}(),Bootstrap3RenderOptions=function(){function a(){}return a.prototype.renderStringField=function(a,b,c){return this.renderField(this.renderHtmlInput("text",a.value,b),a,c)},a.prototype.renderIntegerField=function(a,b,c){return this.renderField(this.renderHtmlInput("number",a.value,b),a,c)},a.prototype.renderFloatField=function(a,b,c){return this.renderField(this.renderHtmlInput("number",a.value,b),a,c)},a.prototype.renderPasswordField=function(a,b,c){return this.renderField(this.renderHtmlInput("password",a.value,b),a,c)},a.prototype.renderHiddenField=function(a,b){return this.renderHiddenFormGroup(this.renderHtmlInput("hidden",a.value,b))},a.prototype.renderTextareaField=function(a,b,c){return this.renderField(this.renderHtmlTextarea(a.value,b),a,c)},a.prototype.renderStaticField=function(a,b){return this.renderField(this.renderStaticText(a.value),a,b)},a.prototype.renderStaticText=function(a){return HtmlUtil.renderTag("div",{"class":"form-control-static"},a)},a.prototype.renderMultiChoiceCheckboxField=function(a,b,c,d,e){return this.renderField(this.renderHtmlCheckboxes(a.value,b,c,d),a,e)},a.prototype.renderMultiChoiceSelectField=function(){return""},a.prototype.renderSingleChoiceRadioField=function(a,b,c,d,e){return this.renderField(this.renderHtmlRadios(a.value,b,c,d),a,e)},a.prototype.renderSingleChoiceSelectField=function(a,b,c,d,e){return this.renderField(this.renderHtmlSelect(a.value,b,d),a,e)},a.prototype.renderActionField=function(a,b,c){var d=Util.copyObject(a);return d.label="",this.renderField(this.renderHtmlButton(a.label,b),d,c)},a.prototype.renderField=function(a,b,c){var d;d=c?"":this.renderLabel(b.id,b.label)+"\n";var e=d+a+"\n"+this.renderValidation(b.validationId)+"\n";return HtmlUtil.renderTag("div",{"class":"form-group"},e,!1)},a.prototype.renderHiddenFormGroup=function(a){return HtmlUtil.renderTag("span",{"class":"hidden-form-group",style:"visibility: hidden; display: none"},a,!1)},a.prototype.renderLabel=function(a,b){return HtmlUtil.renderTag("label",{"for":a},b)},a.prototype.renderValidation=function(a){return HtmlUtil.renderTag("div",{"class":"text-danger",id:a})},a.prototype.renderSubformDecoration=function(a,b,c){var d="\n";return d+=HtmlUtil.renderTag("legend",{},b),d+=a,HtmlUtil.renderTag("fieldset",{id:c},d,!1)},a.prototype.renderSubformListElement=function(a,b){var c=Util.copyProperties({"class":"well"},b);return HtmlUtil.renderTag("div",c,a,!1)},a.prototype.renderSubformTable=function(a,b,c){var d=this.renderSubformTableHeader(a);return d+=this.renderSubformTableBody(b,c),HtmlUtil.renderTag("table",{"class":"table"},d,!1)},a.prototype.renderSubformTableHeader=function(a){var b="";return a.forEach(function(a){return b+=HtmlUtil.renderTag("th",{},a)}),HtmlUtil.renderTag("tr",{},b,!1)},a.prototype.renderSubformTableBody=function(a,b){for(var c="",d=0;d<a.length;d++){for(var e=a[d],f="",g=0;g<e.length;g++)f+=HtmlUtil.renderTag("td",{},e[g],!1);c+=HtmlUtil.renderTag("tr",b,f,!1)+"\n"}return c},a.prototype.renderHtmlInput=function(a,b,c){var d=Util.copyProperties({type:a,value:b},c);return HtmlUtil.renderTag("input",d)},a.prototype.renderHtmlSelect=function(a,b,c){var d="";Util.foreach(b,function(b,c){var e={value:c.id};c.id===a&&(e.selected="selected"),d+=HtmlUtil.renderTag("option",e,c.label)});var e=HtmlUtil.renderTag("select",c,d,!1);return e+="\n"},a.prototype.renderHtmlRadios=function(a,b,c,d){return this.renderCheckable("radio",b,c,d,function(b){return b.id===a})},a.prototype.renderHtmlCheckboxes=function(a,b,c,d){return this.renderCheckable("checkbox",b,c,d,function(b){return a.indexOf(b.id)>=0})},a.prototype.renderHtmlTextarea=function(a,b){return HtmlUtil.renderTag("textarea",b,a)},a.prototype.renderHtmlButton=function(a,b){var c=Util.copyProperties({type:"button"},b);return c["class"]=c["class"].replace("form-control","btn btn-default"),HtmlUtil.renderTag("button",c,a)},a.prototype.renderCheckable=function(a,b,c,d,e){var f=this,g="";return Util.foreach(b,function(b,h){var i=Util.copyProperties({},d);i["class"]=i["class"].replace("form-control",""),e(h)&&(i.checked="checked"),i.id=c.id+"."+h.id;var j=f.renderHtmlInput(a,h.id,i);j+=HtmlUtil.renderTag("span",{},h.label);var k=HtmlUtil.renderTag("label",{},j,!1);g+=HtmlUtil.renderTag("div",{"class":a},k,!1)}),HtmlUtil.renderTag("span",c,g,!1)},a.prototype.additionalFieldOptions=function(){return{"class":"form-control"}},a}(),SendController=function(){function a(a,b,c,d,e){this.suplerForm=a,this.formElementDictionary=b,this.options=c,this.elementSearch=d,this.validation=e,this.refreshCounter=0,this.actionInProgress=!1}return a.prototype.attachRefreshListeners=function(){var a=this;this.ifEnabledForEachFormElement(function(b){"FIELDSET"!=b.nodeName&&(b.onchange=function(){return a.refreshListenerFor(b)})})},a.prototype.attachActionListeners=function(){var a=this;this.ifEnabledForEachFormElement(function(b){b.getAttribute(SuplerAttributes.FIELD_TYPE)===FieldTypes.ACTION&&(b.onclick=function(){return a.actionListenerFor(b)})})},a.prototype.refreshListenerFor=function(a){var b=this;if(!this.actionInProgress&&!this.validation.processClientSingle(a.id)){this.refreshCounter+=1;var c=this.refreshCounter,d=function(){return!b.actionInProgress&&c===b.refreshCounter};this.options.sendFormFunction(this.suplerForm.getValue(),this.sendSuccessFn(d,function(){}),function(){},!1,a)}},a.prototype.actionListenerFor=function(a){var b=this;if(!this.actionInProgress){this.actionInProgress=!0;var c=a.id,d=!this.validation.processClientSingle(c)&&!this.validation.processClient(this.formElementDictionary.getElement(c).validationScope);d?this.options.sendFormFunction(this.suplerForm.getValue(c),this.sendSuccessFn(function(){return!0},function(){return b.actionCompleted()}),function(){return b.actionCompleted()},!0,a):this.actionCompleted()}},a.prototype.actionCompleted=function(){this.actionInProgress=!1},a.prototype.ifEnabledForEachFormElement=function(a){this.options.sendEnabled()&&this.formElementDictionary.foreach(function(b){var c=document.getElementById(b);c&&a(c)})},a.prototype.sendSuccessFn=function(a,b){var c=this;return function(d){if(a()){var e,f=document.activeElement;if(f&&(e=f.getAttribute(SuplerAttributes.PATH)),c.suplerForm.render(d),e){var g=c.elementSearch.byPath(e);g&&g.focus()}}b()}},a}(),SendControllerOptions=function(){function a(a){this.sendFormFunction=a.send_form_function}return a.prototype.sendEnabled=function(){return null!==this.sendFormFunction&&"undefined"!=typeof this.sendFormFunction},a}(),SuplerForm=function(){function a(a,b){this.container=a,b=b||{},this.i18n=new I18n,Util.copyProperties(this.i18n,b.i18n);var c=new Bootstrap3RenderOptions;Util.copyProperties(c,b.render_options),this.renderOptionsGetter=new HTMLRenderTemplateParser(this.container).parse(c),this.validatorFnFactories=new ValidatorFnFactories(this.i18n),Util.copyProperties(this.validatorFnFactories,b.validators),this.validatorRenderOptions=new ValidatorRenderOptions,Util.copyProperties(this.validatorRenderOptions,b.validation_render),this.sendControllerOptions=new SendControllerOptions(b),this.elementSearch=new ElementSearch(a),this.afterRenderFn=b.after_render_function||function(){},this.customDataHandlerFn=b.custom_data_handler||function(){}}return a.prototype.render=function(a){if(this.isSuplerForm(a)){var b=new CreateFormFromJson(this.renderOptionsGetter,this.i18n,this.validatorFnFactories).renderForm(a[FormSections.META],a.main_form);this.container.innerHTML=b.html,this.initializeValidation(b.formElementDictionary,a);var c=new SendController(this,b.formElementDictionary,this.sendControllerOptions,this.elementSearch,this.validation);c.attachRefreshListeners(),c.attachActionListeners()}var d=this.getCustomData(a);d&&this.customDataHandlerFn(d),this.afterRenderFn()},a.prototype.initializeValidation=function(a,b){var c=this.validation;this.validation=new Validation(this.elementSearch,a,this.validatorRenderOptions,this.i18n),this.validation.processServer(b.errors),c&&this.validation.copyFrom(c)},a.prototype.getValue=function(a){return void 0===a&&(a=null),ReadFormValues.getValueFrom(this.container,a)},a.prototype.validate=function(a){return void 0===a&&(a=ValidateAll),this.validation.processClient(a)},a.prototype.getCustomData=function(a){return this.isSuplerForm(a)?a.custom_data:a},a.prototype.isSuplerForm=function(a){return a.is_supler_form===!0},a}(),Util=function(){function a(){}return a.foreach=function(a,b){for(var c in a)a.hasOwnProperty(c)&&b(c,a[c])},a.copyProperties=function(b,c){return a.foreach(c,function(a,c){b[a]=c}),b},a.getSingleProperty=function(a){var b=null;for(var c in a)if(a.hasOwnProperty(c)){if(null!=b)throw"Multiple properties in "+a+", while a single property was expected!";b=a[c]}return b},a.find=function(a,b){for(var c=0;c<a.length;c++)if(b(a[c]))return a[c];return null},a.copyObject=function(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},a.deepEqual=function(a,b){if(a===b)return!0;if(!(a instanceof Object&&a instanceof Object))return!1;if(a.constructor!==b.constructor)return!1;for(var c in a)if(a.hasOwnProperty(c)){if(!b.hasOwnProperty(c))return!1;if(a[c]!==b[c]){if("object"!=typeof a[c])return!1;if(!this.deepEqual(a[c],b[c]))return!1}}for(c in b)if(b.hasOwnProperty(c)&&!a.hasOwnProperty(c))return!1;return!0},a}(),SelectValue=function(){function a(a,b){this.id=a,this.label=b}return a}(),FieldUtil=function(){function a(){}return a.fieldIsEmpty=function(a,b){return null===a||"undefined"==typeof a||0==a.length||a===b},a}(),AllFieldMatcher=function(){function a(){}return a.prototype.matches=function(){return!0},a}(),CompositeFieldMatcher=function(){function a(a,b){this.m1=a,this.m2=b}return a.prototype.matches=function(a,b,c){return this.m1.matches(a,b,c)&&this.m2.matches(a,b,c)},a}(),PathFieldMatcher=function(){function a(a){this.path=a}return a.prototype.matches=function(a){return this.path===a},a}(),TypeFieldMatcher=function(){function a(a){this.type=a}return a.prototype.matches=function(a,b){return this.type===b},a}(),RenderHintFieldMatcher=function(){function a(a){this.renderHintName=a}return a.prototype.matches=function(a,b,c){return this.renderHintName===c},a}(),FieldMatcherParser=function(){function a(){}return a.parseMatcher=function(b){var c=new AllFieldMatcher;return b.hasAttribute(a.FIELD_PATH_MATCHER)&&(c=new CompositeFieldMatcher(c,new PathFieldMatcher(b.getAttribute(a.FIELD_PATH_MATCHER)))),b.hasAttribute(a.FIELD_TYPE_MATCHER)&&(c=new CompositeFieldMatcher(c,new TypeFieldMatcher(b.getAttribute(a.FIELD_TYPE_MATCHER)))),b.hasAttribute(a.FIELD_RENDERHINT_MATCHER)&&(c=new CompositeFieldMatcher(c,new RenderHintFieldMatcher(b.getAttribute(a.FIELD_RENDERHINT_MATCHER)))),c},a.FIELD_PATH_MATCHER="supler:fieldPath",a.FIELD_TYPE_MATCHER="supler:fieldType",a.FIELD_RENDERHINT_MATCHER="supler:fieldRenderHint",a}(),HTMLRenderTemplateParser=function(){function a(a){this.container=a}return a.prototype.parse=function(a){for(var b=[],c=0;c<this.container.children.length;c++){var d=this.container.children[c];if(d.tagName){var e=this.parseElement(d);e&&b.push(e)}}return new RenderOptionsGetter(a,b)},a.prototype.parseElement=function(a){var b=SingleTemplateParser.parseRenderOptionsModifier(a);return b?new HTMLRenderTemplate(FieldMatcherParser.parseMatcher(a),b):null},a}(),HTMLRenderTemplate=function(){function a(a,b){this.matcher=a,this.renderOptionsModifier=b}return a}(),RenderOptionsGetter=function(){function a(a,b){this.fallbackRenderOptions=a,this.templates=b}return a.prototype.forField=function(a,b,c){for(var d=this.fallbackRenderOptions,e=0;e<this.templates.length;e++){var f=this.templates[e];f.matcher.matches(a,b,c)&&(d=f.renderOptionsModifier(d))}return d},a}(),SingleTemplateParser=function(){function a(){}return a.parseRenderOptionsModifier=function(a){return a.hasAttribute(this.FIELD_TEMPLATE)?this.parseFieldTemplate(a):a.hasAttribute(this.FIELD_LABEL_TEMPLATE)?this.parseFieldLabelTemplate(a):a.hasAttribute(this.FIELD_VALIDATION_TEMPLATE)?this.parseFieldValidationTemplate(a):a.hasAttribute(this.FIELD_INPUT_TEMPLATE)?this.parseFieldInputTemplate(a):null},a.parseFieldTemplate=function(a){var b=a.innerHTML;return this.createModifierWithOverride(function(){this.renderField=function(a,c,d){var e=d?"":this.renderLabel(c.id,c.label),f=this.renderValidation(c.validationId);return b.replace("{{suplerLabel}}",e).replace("{{suplerInput}}",a).replace("{{suplerValidation}}",f)}})},a.parseFieldLabelTemplate=function(a){var b=a.innerHTML;return this.createModifierWithOverride(function(){this.renderLabel=function(a,c){return b.replace("{{suplerLabelForId}}",a).replace("{{suplerLabelText}}",c)}})},a.parseFieldValidationTemplate=function(a){var b=a.innerHTML;return this.createModifierWithOverride(function(){this.renderValidation=function(a){return b.replace("{{suplerValidationId}}",a)}})},a.parseFieldInputTemplate=function(a){function b(a,b,c){var d=a.indexOf(g)>-1;null===c||d?delete b.value:b.value=c}function c(a,c,d){return b(a,c,d),a.replace(f,HtmlUtil.renderAttrs(c)).replace(f.toLowerCase(),HtmlUtil.renderAttrs(c)).replace(g,d).replace(g.toLowerCase(),d)}function d(b,d,f,g){var i=a.hasAttribute("super:singleInput")&&"true"===a.getAttribute("super:singleInput").toLowerCase();i&&(d=f);var j=HtmlUtil.findElementWithAttr(a,"supler:possibleValueTemplate").outerHTML,k="";return Util.foreach(b,function(b,d){var e=Util.copyProperties({},f);e.id=f.id+"."+d.id,g(d)&&(e[a.getAttribute("supler:selectedAttrName")]=a.getAttribute("supler:selectedAttrValue")),k+=c(j,e,d.id).replace("{{suplerFieldInputLabel}}",d.label)}),e.replace(h,HtmlUtil.renderAttrs(d)).replace(h.toLowerCase(),HtmlUtil.renderAttrs(d)).replace(j,k)}var e=a.innerHTML,f="{{suplerFieldInputAttrs}}",g="{{suplerFieldInputValue}}",h="{{suplerFieldInputContainerAttrs}}";return this.createModifierWithOverride(function(){this.additionalFieldOptions=function(){return{}},this.renderHtmlInput=function(a,b,d){var f=Util.copyProperties({type:a},d);return c(e,f,b)},this.renderHtmlTextarea=function(a,b){return c(e,b,a)},this.renderHtmlButton=function(a,b){return c(e,b,null)},this.renderHtmlSelect=function(a,b,c,e){return d(b,c,e,function(b){return b.id===a})},this.renderHtmlRadios=function(a,b,c,e){return d(b,c,e,function(b){return b.id===a})},this.renderHtmlCheckboxes=function(a,b,c,e){return d(b,c,e,function(b){return a.indexOf(b.id)>=0})}})},a.createModifierWithOverride=function(a){return function(b){return a.prototype=b,new a}},a.FIELD_TEMPLATE="supler:fieldTemplate",a.FIELD_LABEL_TEMPLATE="supler:fieldLabelTemplate",a.FIELD_VALIDATION_TEMPLATE="supler:fieldValidationTemplate",a.FIELD_INPUT_TEMPLATE="supler:fieldInputTemplate",a}(),ElementValidator=function(){function a(a,b,c){this.validatorFns=a,this.required=b,this.emptyValue=c}return a.prototype.validate=function(a){var b=Util.getSingleProperty(ReadFormValues.getValueFrom(a));if(this.required!==!0&&FieldUtil.fieldIsEmpty(b,this.emptyValue))return[];for(var c=[],d=0;d<this.validatorFns.length;d++){var e=this.validatorFns[d](b);e&&c.push(e)}return c},a}(),Validation=function(){function a(a,b,c,d){this.elementSearch=a,this.formElementDictionary=b,this.validatorRenderOptions=c,this.i18n=d,this.addedValidations={}}return a.prototype.processServer=function(a){if(this.removeAllValidationErrors(),a)for(var b=0;b<a.length;b++){var c=a[b],d=c.field_path,e=this.elementSearch.byPath(d),f=this.lookupValidationElement(e);this.appendValidation(this.i18n.fromKeyAndParams(c.error_key,c.error_params),f,e)}return a&&a.length>0},a.prototype.processClient=function(a){var b=this;this.removeAllValidationErrors();var c=!1;return this.formElementDictionary.foreach(function(d,e){var f=document.getElementById(d);f&&a.shouldValidate(f.getAttribute(SuplerAttributes.PATH))&&(c=b.doProcessClientSingle(f,e.validator)||c)}),c},a.prototype.processClientSingle=function(a){this.removeSingleValidationErrors(a);var b=this.formElementDictionary.getElement(a).validator,c=document.getElementById(a);return c&&b?this.doProcessClientSingle(c,b):!1},a.prototype.doProcessClientSingle=function(a,b){for(var c=!1,d=this.lookupValidationElement(a),e=b.validate(a),f=0;f<e.length;f++)this.appendValidation(e[f],d,a),c=!0;return c},a.prototype.lookupValidationElement=function(a){var b=a.getAttribute(SuplerAttributes.VALIDATION_ID);return document.getElementById(b)},a.prototype.removeAllValidationErrors=function(){Util.foreach(this.addedValidations,function(a,b){b.remove()}),this.addedValidations={}},a.prototype.removeSingleValidationErrors=function(a){var b=this.addedValidations[a];b&&(b.remove(),delete this.addedValidations[a])},a.prototype.appendValidation=function(a,b,c){this.addedValidations.hasOwnProperty(c.id)||(this.addedValidations[c.id]=new AddedValidation(this.validatorRenderOptions,c,b));var d=this.addedValidations[c.id];d.addText(a)&&this.validatorRenderOptions.appendValidation(a,b,c)},a.prototype.copyFrom=function(a){var b=this;Util.foreach(a.addedValidations,function(a,c){var d=b.elementSearch.byPath(c.formElementPath());if(d&&Util.deepEqual(c.invalidValue,ReadFormValues.getValueFrom(d))){var e=b.lookupValidationElement(d);c.texts.forEach(function(a){b.appendValidation(a,e,d)})}})},a}(),AddedValidation=function(){function a(a,b,c){this.validatorRenderOptions=a,this.formElement=b,this.validationElement=c,this.texts=[],this.invalidValue=ReadFormValues.getValueFrom(b)}return a.prototype.addText=function(a){return-1===this.texts.indexOf(a)?(this.texts.push(a),!0):!1},a.prototype.formElementPath=function(){return this.formElement.getAttribute(SuplerAttributes.PATH)},a.prototype.remove=function(){this.validatorRenderOptions.removeValidation(this.validationElement,this.formElement)},a}(),_ValidateAll=function(){function a(){}return a.prototype.shouldValidate=function(){return!0},a}(),ValidateAll=new _ValidateAll,_ValidateNone=function(){function a(){}return a.prototype.shouldValidate=function(){return!1},a}(),ValidateNone=new _ValidateNone,ValidateInPath=function(){function a(a){this.rootPath=a}return a.prototype.shouldValidate=function(a){return a&&(a===this.rootPath||0===a.indexOf(this.rootPath+".")||0===a.indexOf(this.rootPath+"["))},a}(),ValidationScopeParser=function(){function a(){}return a.fromJson=function(a){switch(a.name){case"none":return ValidateNone;case"all":return ValidateAll;case"path":return new ValidateInPath(a.path);default:return ValidateNone}},a}(),ValidatorFnFactories=function(){function a(a){this.i18n=a}return a.prototype.required=function(a,b){var c=this;return function(d){return a===!0&&FieldUtil.fieldIsEmpty(d,b.empty_value)?c.i18n.error_valueRequired():null}},a.prototype.ge=function(a){var b=this;return function(c){return parseFloat(c)>=a?null:b.i18n.error_number_ge(a)}},a.prototype.gt=function(a){var b=this;return function(c){return parseFloat(c)>a?null:b.i18n.error_number_gt(a)}},a.prototype.le=function(a){var b=this;return function(c){return parseFloat(c)<=a?null:b.i18n.error_number_le(a)}},a.prototype.lt=function(a){var b=this;return function(c){return parseFloat(c)<a?null:b.i18n.error_number_lt(a)}},a.prototype.min_length=function(a){var b=this;return function(c){return c.length>=a?null:b.i18n.error_length_tooShort(a)}},a.prototype.max_length=function(a){var b=this;return function(c){return c.length<=a?null:b.i18n.error_length_tooLong(a)}},a.prototype.type_integer=function(){var a=this;return function(b){return parseInt(b)===b?null:a.i18n.error_type_number()}},a.prototype.type_float=function(){var a=this;return function(b){return parseFloat(b)===b?null:a.i18n.error_type_number()}},a}(),ValidatorRenderOptions=function(){function a(){}return a.prototype.appendValidation=function(a,b,c){var d=b.innerHTML;b.innerHTML=d&&d.length>0?d+"; "+a:a,HtmlUtil.addClass(c.parentElement,"has-error")},a.prototype.removeValidation=function(a,b){a.innerHTML="",HtmlUtil.removeClass(b.parentElement,"has-error")},a}();